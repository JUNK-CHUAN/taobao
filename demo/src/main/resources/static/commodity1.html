<!DOCTYPE html>
<html>
<head>
    <title>商品详情静态样例</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="css/normalize.css"/>

    <link rel="shortcut icon"type="image/x-icon" href="./img/logo.ico"media="screen" />
    <link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdn.bootcss.com/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://cdn.bootcss.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <!-- 最新版本的 Bootstrap 核心 CSS 文件 -->
    <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script> -->
    <script src="jquery/jquery-3.5.1.min.js"></script>
</head>
<body>
<header>
    <nav class="navbar navbar-expand-lg navbar-light bg-light" style="height: 80px; font-size: 22px; padding-left: 200px; padding-right: 200px;">
        <a href="home.html">
            <img src="img/LOGO.png" id="homepage" height="70" style="margin-bottom: 5px; margin-top: 5px; margin-right: 10px;" alt="">
        </a>

        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item active">
                    <svg t="1592452916316" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="7643" width="21" height="21" style="margin-top: 12px; margin-left: 12px;"><path d="M756 657.1l-373.1-1L326 309.9c-4.1-32.1-31.6-56.3-63.9-56.3h-54.7c-17.9 0-32.3 14.5-32.3 32.3 0 17.9 14.5 32.3 32.3 32.3l54.6 1 57 346.3c4.1 32.1 31.6 56.3 63.9 56.3H756c17.9 0 32.3-14.5 32.3-32.3 0.1-17.9-14.4-32.4-32.3-32.4zM714.7 742.9c-22.8 0-41.2 18.5-41.2 41.2 0 22.8 18.5 41.2 41.2 41.2s41.2-18.5 41.2-41.2c0.1-22.7-18.4-41.2-41.2-41.2zM415.7 742.9c-22.8 0-41.2 18.5-41.2 41.2 0 22.8 18.5 41.2 41.2 41.2 22.8 0 41.2-18.5 41.2-41.2 0-22.7-18.5-41.2-41.2-41.2z" p-id="7644"></path><path d="M834 321.3c-12.3-14.6-30.3-23-49.4-23H397.5c-17.9 0-32.3 14.5-32.3 32.3 0 17.9 14.5 32.3 32.3 32.3l387.1-1-36.8 183.5H438.7c-17.9 0-32.3 14.5-32.3 32.3 0 17.9 14.5 32.3 32.3 32.3h309.1c31.3 0 58-22.4 63.3-52.5l37-183.7c3.3-18.7-1.8-37.9-14.1-52.5z" p-id="7645"></path><path d="M512.1 0C229.8 0 0.2 229.6 0.2 511.9c0 282.3 229.6 511.9 511.9 511.9 282.3 0 511.9-229.6 511.9-511.9C1024 229.6 794.4 0 512.1 0z m0 959.1c-246.6 0-447.2-200.6-447.2-447.2S265.5 64.6 512.1 64.6s447.3 200.6 447.3 447.3c0 246.6-200.7 447.2-447.3 447.2z" p-id="7646"></path></svg>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="cart.html">购物车</a>
                </li>
                <li class="nav-item">
                    <svg t="1592452630128" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1135" width="22" height="22" style="margin-top: 12px; margin-left: 12px;"><path d="M512 1.638C230.103 1.638 1.638 230.103 1.638 512c0 281.836 228.465 510.362 510.362 510.362 281.836 0 510.362-228.516 510.362-510.362C1022.362 230.103 793.836 1.638 512 1.638z m-0.154 969.636c-253.634 0-459.325-205.64-459.325-459.315 0-253.686 205.69-459.325 459.325-459.325 253.686 0 459.316 205.64 459.316 459.325 0.01 253.676-205.62 459.315-459.316 459.315zM620.278 532.43c57.6-36.199 96.01-100.127 96.01-173.169 0-112.957-91.597-204.513-204.544-204.513-112.988 0-204.544 91.556-204.544 204.513 0 72.581 37.908 136.182 94.904 172.493-115.568 43.735-197.765 155.382-197.765 286.27v0.204h51.733c0.399-139.868 113.234-253.266 252.887-254.525 0.942 0.01 1.853 0.143 2.785 0.143 0.84 0 1.649-0.123 2.488-0.133 139.387 1.577 251.843 114.862 252.293 254.515h49.839v-0.205c0.01-130.252-81.408-241.418-196.086-285.593z m-110.019-21.033c-84.828 0-153.6-68.772-153.6-153.6 0-84.828 68.782-153.6 153.6-153.6s153.6 68.782 153.6 153.6c0 84.828-68.782 153.6-153.6 153.6z" p-id="1136"></path></svg>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        我的
                    </a>
                    <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                        <a class="dropdown-item" href="#">个人中心</a>
                        <a class="dropdown-item" href="order.html">订单信息</a>
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item logoutBtn" onclick="logout()">注销</a>
                    </div>
                </li>
            </ul>
            <form class="form-inline my-2 my-lg-0" style="width: 400px;">
                <input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search" style="width: 310px;">
                <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
            </form>
        </div>
    </nav>
</header>

<div class="showall">
    <!--left -->
    <div class="showbot">
         <!-- 一个大盒子，用以控制位置 -->
        <div id="enlarge_box" class="enlarge_box">
            <!-- 小图片盒子 -->
            <div class="small" id="showbox">
                <img class="spPic" src="img/photos/img01.png" width="350px">
                <!-- 遮盖层 -->
                <div class="cover"></div>
            </div>
                <!-- 大图片 -->
            <div class="big" class="enlarge_box">
                <img class="bigSpPic" src="img/photos/img01.png" width="600px">
            </div>
        </div>
    </div>
    
        <!--conet -->
    <div class="tb-property">
        <div class="tr-nobdr">
            <h3> 东北特产大礼包</h3>
        </div>
        <div class="txt">
            <span class="nowprice">￥<a href="">599.00</a></span>
            <div class="cumulative">
                <span class="number ty1">累计售出<br /><em id="add_sell_num_363">370</em></span>
                <span class="number tyu">累计评价<br /><em id="add_sell_num_363">25</em></span>
            </div>
        </div>
  
        <div class="gcIpt">
            <span class="guT">数量</span>
            <input id="min" name="" type="button" value="-" />  
            <input id="text_box" name="" type="text" value="1"style="width:30px; text-align: center; color: #0F0F0F;"/>  
            <input id="add" name="" type="button" value="+" />
            <span class="Hgt">库存（<span class="stock_num">99</span>）</span>
        </div>
        <div class="nobdr-btns">
            <button class="addcart" onclick="add_cart()"> <img src="img/shop.png" width="25" height="25"/>加入购物车</button>
            <!-- <button class="addcart yh"><img src="img/ht.png" width="25" height="25"/>立即购买</button> -->
        </div>
        <div class="guarantee">
            <span>邮费：包邮&nbsp;&nbsp;支持货到付款 <a href=""><img src="img/me.png"/></a></span>
        </div>
    </div>
        <!--right -->
</div>             
             
<!-- 商品介紹 -->                
<div class="gdetail">
    <!-- 详情 -->
    <div class="detail">
        <div class="active_tab" id="outer">
            <ul class="act_title_left" id="tab">
                <li class="act_active">
                    <a href="#">商品详情</a>
                </li>
            </ul>
        </div>
        <div id="content" class="active_list"> 
            <div id="ui-a" class="ui-a">
                <ul style="display:block;">
                    <li>商品名称：<span class = "spdetail_name" >东北地区特产大礼包</span></li>
                    <li>商品编号：<span class = "spdetail_ID">ECS001983</span></li>
                    <li>商家：<span class = "spdetail_sName"> 一百只松鼠</span></li>
                    <li>库存：<span class = "spdetail_stock">999</span>  </li>
                    <li><img src="img/ko-1.jpg"/></li>
                    <li><img src="img/ko-2.jpg"/></li>                       
                    <li><img src="img/ko.jpg"/></li>
                    <li><img src="img/ko-1.jpg"/></li>
                </ul>
            </div>
        </div>
                                 <!--商品评价-->      
        <div id="ui-c" class="ui-c">
            <ul style="display:none;">
            </ul>
        </div>
    </div>
</div>>

<script>
$(document).ready(function () {
        $.ajax({
            url : "http://127.0.0.1:8080/getCurrentUserInfo",
            type : 'GET',
            dataType : 'json',
            crossOrigin: true,
            success: function (data) {
                console.log(JSON.stringify(data));
                if (data.result === "false") {
                    window.location.href = "./login.html";
                }
                else{
                    spid = "1";
                    $.ajax({
                        url: "http://127.0.0.1:8080/getSpecialtyInfo/"+spid,
                        type: 'GET',
                        dataType:'json',
                        crossOrigin: true,
                        cache: false,
                        success: function (data) {
                            console.log('success,'+JSON.stringify(data));

                            if (data.result === 'true') {
                                var jsonData = data["data"];
                                // $(".tr-nobdr").text(jsonData["name"]);
                                // $(".nowprice").text(jsonData["price"]);
                                // $(".spPic").attr('src',jsonData["picUrl"]);
                                // $(".bigSpPic").attr('src',jsonData["picUrl"]);
                                // $(".stock_num").text(jsonData["stock"]);
                                // $(".spdetail_name").text(jsonData["name"]);
                                // $(".spdetail_ID").text(jsonData["spID"]);
                                // $(".spdetail_sName").text(jsonData["sName"]);
                                // $(".spdetail_stock").text(jsonData["stock"]);
                            }
                        },
                        error: function (data) {
                            console.log("false");
                            console.log(data);
                        }
                    });
                }

            }
        })
    });

    //加入购物车
    function add_cart () {
        let spid = 1;
        console.log('send');
        var url = 'http://127.0.0.1:8080/insertCart';
        var info = {
            "spID": spid,
            "count":document.getElementById("text_box").value
        };
        console.log(JSON.stringify(info));

        $.ajax({
            url: url,
            type: 'POST',
            dataType:'json',
            crossOrigin: true,
            data: info,
            cache: false,
            success: function (data) {
                console.log('success,'+JSON.stringify(data));

                if (data.result === 'true') {
                    window.location.href = "./cart.html";
                }
            },
            error: function (data) {
                console.log("false");
                console.log(data);
            }
        });
    };

    function logout() {
        console.log("click");
        $.ajax({
            url: "http://127.0.0.1:8080/logout",
            type: "GET",
            dataType: 'json',
            crossOrigin: true,
            success: function (data) {
                console.log(JSON.stringify(data));
                if (data.result === 'true') {
                    window.location.href = "./login.html";
                }
            },
            error: function (data) {
                console.log(data)
            }
        })
    };


    function search() {
        var storage = window.localStorage;
        storage.setItem("urlpattern", "/search");
        var keyword = $("input[type='search']").val();
        storage.setItem("keyword", "/"+keyword);
        window.location.href = "./goodList.html";
    }

    //购买数量
    $(document).ready(function(){
        var t = $("#text_box");
        $('#min').attr('disabled',true);
        $("#add").click(function(){
            t.val(parseInt(t.val())+1)
            if (parseInt(t.val())!=1){
                $('#min').attr('disabled',false);
            }
        })
        $("#min").click(function(){
            t.val(parseInt(t.val())-1);
            if (parseInt(t.val())==1){
                $('#min').attr('disabled',true);
            }
        })
    });               
    </script>
    
    <script type="text/javascript">
        //放大镜
        // 1.获取需要操作的元素
        var box=document.getElementById('enlarge_box');
        var smallBox=box.children[0];
        var bigBox=box.children[1];
        var cover=smallBox.children[1];
        var bigImage=bigBox.children[0];
        //2.鼠标移动进入小盒子,遮盖层和大图片出现
        box.onmouseenter=function(){
            cover.style.display="block";
            bigBox.style.display="block";
        }
        //3.鼠标离开小盒子,遮盖层和大图片隐藏
        box.onmouseleave=function(){
            cover.style.display="none";
            bigBox.style.display="none";
        }
    
        //4.鼠标移动,遮盖层跟着移动,并且鼠标点位于遮盖层的中心位置
        box.onmousemove=function(e){
            e = e || window.event;
            //实现思路:鼠标在盒子中的位置=鼠标在文档中位置-盒子位置
            var mouse_in_documentX=e.pageX || e.clientX + (document.documentElement.scrollLeft || document.body.scrollLeft);
            var mouse_in_documentY=e.pageY || e.clientY+(document.documentElement.scrollTop || document.body.scrollTop);
            //鼠标在盒子中的位置,就是遮盖层的位置
            var mouse_in_boxX=mouse_in_documentX-box.offsetLeft;
            var mouse_in_boxY=mouse_in_documentY-box.offsetTop;
            //让鼠标位于遮盖层的中央
            var coverX=mouse_in_boxX - cover.offsetWidth/2 ;
            var coverY=mouse_in_boxY - cover.offsetHeight/2;
            //遮盖层不能超过小盒子范围
            coverX= ( coverX < 0 ) ? 0 : coverX;
            coverY= ( coverY < 0 ) ? 0 : coverY;
            coverX=( coverX > ( box.offsetWidth - cover.offsetWidth)) ? ( box.offsetWidth - cover.offsetWidth) : coverX;
            coverY=( coverY > ( box.offsetHeight - cover.offsetHeight)) ? ( box.offsetHeight - cover.offsetHeight) : coverY;
            cover.style.top=coverY + 'px';
            cover.style.left=coverX + 'px';
            //当遮盖层移动的时候,大图片跟着遮盖层移动(比例关系换算问题)
            //公式：遮盖层移动距离/遮盖层最大移动距离=大图片移动距离/大图片最大移动距离
            //故:大图片移动距离=遮盖层移动距离/遮盖层最大移动距离*大图片最大移动距离
    
            //遮盖层最大距离
            var coverMax=box.offsetWidth-cover.offsetWidth;
            //大图片最大移动距离
            var bigImageMax=bigImage.offsetWidth-bigBox.offsetWidth;
    
            var bigImageX=coverX*bigImageMax/coverMax;
            var bigImageY=coverY*bigImageMax/coverMax;
    
            bigImage.style.top=-bigImageY+'px';
            bigImage.style.left=-bigImageX+'px';
        }
    </script>
</body>
</html>